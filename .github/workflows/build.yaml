name: build

on:
  - push

jobs:
  # build-linux:
  #   runs-on: ubuntu-latest

  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Build
  #       run: |
  #         cargo build --release \
  #           && strip target/release/home \
  #           && mv target/release/home target/release/home_amd64

  #     - name: Release
  #       uses: softprops/action-gh-release@v1
  #       if: startsWith(github.ref, 'refs/tags/')
  #       with:
  #         files: |
  #           target/release/home_amd64
  #       env:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  build-armv6:
    runs-on: ubuntu-latest

    env:
      RUNNER_ARCH: ARM

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build
        run: |
          rustup target add arm-unknown-linux-gnueabihf

          cargo build --release --target arm-unknown-linux-gnueabihf \
            && strip target/release/home \
            && mv target/release/home target/release/home_armv6

      - name: Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            target/release/home_armv6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
